{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar core_1 = require(\"@angular/core\");\n\nvar drop_event_model_1 = require(\"../shared/drop-event.model\");\n\nvar ng_drag_drop_service_1 = require(\"../services/ng-drag-drop.service\");\n\nvar dom_helper_1 = require(\"../shared/dom-helper\");\n\nvar ɵngcc0 = require('@angular/core');\n\nvar ɵngcc1 = require('../services/ng-drag-drop.service');\n\nvar Droppable =\n/** @class */\nfunction () {\n  function Droppable(el, renderer, ng2DragDropService, zone) {\n    this.el = el;\n    this.renderer = renderer;\n    this.ng2DragDropService = ng2DragDropService;\n    this.zone = zone;\n    /**\r\n     *  Event fired when Drag dragged element enters a valid drop target.\r\n     */\n\n    this.onDragEnter = new core_1.EventEmitter();\n    /**\r\n     * Event fired when an element is being dragged over a valid drop target\r\n     */\n\n    this.onDragOver = new core_1.EventEmitter();\n    /**\r\n     * Event fired when a dragged element leaves a valid drop target.\r\n     */\n\n    this.onDragLeave = new core_1.EventEmitter();\n    /**\r\n     * Event fired when an element is dropped on a valid drop target.\r\n     */\n\n    this.onDrop = new core_1.EventEmitter();\n    /**\r\n     * CSS class that is applied when a compatible draggable is being dragged over this droppable.\r\n     */\n\n    this.dragOverClass = 'drag-over-border';\n    /**\r\n     * CSS class applied on this droppable when a compatible draggable item is being dragged.\r\n     * This can be used to visually show allowed drop zones.\r\n     */\n\n    this.dragHintClass = 'drag-hint-border';\n    /**\r\n     * Defines compatible drag drop pairs. Values must match both in draggable and droppable.dropScope.\r\n     */\n\n    this.dropScope = 'default';\n    /**\r\n     * @private\r\n     * Backing field for the dropEnabled property\r\n     */\n\n    this._dropEnabled = true;\n    /**\r\n     * @private\r\n     * Field for tracking drag state. Helps when\r\n     * drag stop event occurs before the allowDrop()\r\n     * can be calculated (async).\r\n     */\n\n    this._isDragActive = false;\n    /**\r\n     * @private\r\n     * Field for tracking if service is subscribed.\r\n     * Avoids creating multiple subscriptions of service.\r\n     */\n\n    this._isServiceActive = false;\n  }\n\n  Object.defineProperty(Droppable.prototype, \"dropEnabled\", {\n    get: function () {\n      return this._dropEnabled;\n    },\n\n    /**\r\n     * Defines if drop is enabled. `true` by default.\r\n     */\n    set: function (value) {\n      this._dropEnabled = value;\n\n      if (this._dropEnabled === true) {\n        this.subscribeService();\n      } else {\n        this.unsubscribeService();\n      }\n    },\n    enumerable: true,\n    configurable: true\n  });\n  ;\n\n  Droppable.prototype.ngOnInit = function () {\n    if (this.dropEnabled === true) {\n      this.subscribeService();\n    }\n  };\n\n  Droppable.prototype.ngOnDestroy = function () {\n    this.unsubscribeService();\n    this.unbindDragListeners();\n  };\n\n  Droppable.prototype.dragEnter = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n    this.onDragEnter.emit(e);\n  };\n\n  Droppable.prototype.dragOver = function (e, result) {\n    if (result) {\n      dom_helper_1.DomHelper.addClass(this.el, this.dragOverClass);\n      e.preventDefault();\n      this.onDragOver.emit(e);\n    }\n  };\n\n  Droppable.prototype.dragLeave = function (e) {\n    dom_helper_1.DomHelper.removeClass(this.el, this.dragOverClass);\n    e.preventDefault();\n    this.onDragLeave.emit(e);\n  };\n\n  Droppable.prototype.drop = function (e) {\n    var _this = this;\n\n    this.allowDrop().subscribe(function (result) {\n      if (result && _this._isDragActive) {\n        dom_helper_1.DomHelper.removeClass(_this.el, _this.dragOverClass);\n        e.preventDefault();\n        e.stopPropagation();\n\n        _this.ng2DragDropService.onDragEnd.next();\n\n        _this.onDrop.emit(new drop_event_model_1.DropEvent(e, _this.ng2DragDropService.dragData));\n\n        _this.ng2DragDropService.dragData = null;\n        _this.ng2DragDropService.scope = null;\n      }\n    });\n  };\n\n  Droppable.prototype.allowDrop = function () {\n    var _this = this;\n\n    var allowed = false;\n    /* tslint:disable:curly */\n\n    /* tslint:disable:one-line */\n\n    if (typeof this.dropScope === 'string') {\n      if (typeof this.ng2DragDropService.scope === 'string') allowed = this.ng2DragDropService.scope === this.dropScope;else if (this.ng2DragDropService.scope instanceof Array) allowed = this.ng2DragDropService.scope.indexOf(this.dropScope) > -1;\n    } else if (this.dropScope instanceof Array) {\n      if (typeof this.ng2DragDropService.scope === 'string') allowed = this.dropScope.indexOf(this.ng2DragDropService.scope) > -1;else if (this.ng2DragDropService.scope instanceof Array) allowed = this.dropScope.filter(function (item) {\n        return _this.ng2DragDropService.scope.indexOf(item) !== -1;\n      }).length > 0;\n    } else if (typeof this.dropScope === 'function') {\n      allowed = this.dropScope(this.ng2DragDropService.dragData);\n\n      if (allowed instanceof rxjs_1.Observable) {\n        return allowed.pipe(operators_1.map(function (result) {\n          return result && _this.dropEnabled;\n        }));\n      }\n    }\n    /* tslint:enable:curly */\n\n    /* tslint:disable:one-line */\n\n\n    return rxjs_1.of(allowed && this.dropEnabled);\n  };\n\n  Droppable.prototype.subscribeService = function () {\n    var _this = this;\n\n    if (this._isServiceActive === true) {\n      return;\n    }\n\n    this._isServiceActive = true;\n    this.dragStartSubscription = this.ng2DragDropService.onDragStart.subscribe(function () {\n      _this._isDragActive = true;\n\n      _this.allowDrop().subscribe(function (result) {\n        if (result && _this._isDragActive) {\n          dom_helper_1.DomHelper.addClass(_this.el, _this.dragHintClass);\n\n          _this.zone.runOutsideAngular(function () {\n            _this.unbindDragEnterListener = _this.renderer.listen(_this.el.nativeElement, 'dragenter', function (dragEvent) {\n              _this.dragEnter(dragEvent);\n            });\n            _this.unbindDragOverListener = _this.renderer.listen(_this.el.nativeElement, 'dragover', function (dragEvent) {\n              _this.dragOver(dragEvent, result);\n            });\n            _this.unbindDragLeaveListener = _this.renderer.listen(_this.el.nativeElement, 'dragleave', function (dragEvent) {\n              _this.dragLeave(dragEvent);\n            });\n          });\n        }\n      });\n    });\n    this.dragEndSubscription = this.ng2DragDropService.onDragEnd.subscribe(function () {\n      _this._isDragActive = false;\n      dom_helper_1.DomHelper.removeClass(_this.el, _this.dragHintClass);\n\n      _this.unbindDragListeners();\n    });\n  };\n\n  Droppable.prototype.unsubscribeService = function () {\n    this._isServiceActive = false;\n\n    if (this.dragStartSubscription) {\n      this.dragStartSubscription.unsubscribe();\n    }\n\n    if (this.dragEndSubscription) {\n      this.dragEndSubscription.unsubscribe();\n    }\n  };\n\n  Droppable.prototype.unbindDragListeners = function () {\n    if (this.unbindDragEnterListener) {\n      this.unbindDragEnterListener();\n    }\n\n    if (this.unbindDragOverListener) {\n      this.unbindDragOverListener();\n    }\n\n    if (this.unbindDragLeaveListener) {\n      this.unbindDragLeaveListener();\n    }\n  };\n  /** @nocollapse */\n\n\n  Droppable.ctorParameters = function () {\n    return [{\n      type: core_1.ElementRef\n    }, {\n      type: core_1.Renderer2\n    }, {\n      type: ng_drag_drop_service_1.NgDragDropService\n    }, {\n      type: core_1.NgZone\n    }];\n  };\n\n  Droppable.propDecorators = {\n    onDragEnter: [{\n      type: core_1.Output\n    }],\n    onDragOver: [{\n      type: core_1.Output\n    }],\n    onDragLeave: [{\n      type: core_1.Output\n    }],\n    onDrop: [{\n      type: core_1.Output\n    }],\n    dragOverClass: [{\n      type: core_1.Input\n    }],\n    dragHintClass: [{\n      type: core_1.Input\n    }],\n    dropScope: [{\n      type: core_1.Input\n    }],\n    dropEnabled: [{\n      type: core_1.Input\n    }],\n    drop: [{\n      type: core_1.HostListener,\n      args: ['drop', ['$event']]\n    }]\n  };\n\n  Droppable.ɵfac = function Droppable_Factory(t) {\n    return new (t || Droppable)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.NgDragDropService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone));\n  };\n\n  Droppable.ɵdir = /*@__PURE__*/ɵngcc0.ɵɵdefineDirective({\n    type: Droppable,\n    selectors: [[\"\", \"droppable\", \"\"]],\n    hostBindings: function Droppable_HostBindings(rf, ctx) {\n      if (rf & 1) {\n        ɵngcc0.ɵɵlistener(\"drop\", function Droppable_drop_HostBindingHandler($event) {\n          return ctx.drop($event);\n        });\n      }\n    },\n    inputs: {\n      dragOverClass: \"dragOverClass\",\n      dragHintClass: \"dragHintClass\",\n      dropScope: \"dropScope\",\n      dropEnabled: \"dropEnabled\"\n    },\n    outputs: {\n      onDragEnter: \"onDragEnter\",\n      onDragOver: \"onDragOver\",\n      onDragLeave: \"onDragLeave\",\n      onDrop: \"onDrop\"\n    }\n  });\n\n  (function () {\n    (typeof ngDevMode === \"undefined\" || ngDevMode) && void 0;\n  })();\n\n  return Droppable;\n}();\n\nexports.Droppable = Droppable; //# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJvcHBhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZXMiOlsiZHJvcHBhYmxlLmRpcmVjdGl2ZS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLE1BS007QUFDTjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFNO0FBQ047QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG52YXIgcnhqc18xID0gcmVxdWlyZShcInJ4anNcIik7XHJcbnZhciBvcGVyYXRvcnNfMSA9IHJlcXVpcmUoXCJyeGpzL29wZXJhdG9yc1wiKTtcclxudmFyIGNvcmVfMSA9IHJlcXVpcmUoXCJAYW5ndWxhci9jb3JlXCIpO1xyXG52YXIgZHJvcF9ldmVudF9tb2RlbF8xID0gcmVxdWlyZShcIi4uL3NoYXJlZC9kcm9wLWV2ZW50Lm1vZGVsXCIpO1xyXG52YXIgbmdfZHJhZ19kcm9wX3NlcnZpY2VfMSA9IHJlcXVpcmUoXCIuLi9zZXJ2aWNlcy9uZy1kcmFnLWRyb3Auc2VydmljZVwiKTtcclxudmFyIGRvbV9oZWxwZXJfMSA9IHJlcXVpcmUoXCIuLi9zaGFyZWQvZG9tLWhlbHBlclwiKTtcclxudmFyIERyb3BwYWJsZSA9IC8qKiBAY2xhc3MgKi8gKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIERyb3BwYWJsZShlbCwgcmVuZGVyZXIsIG5nMkRyYWdEcm9wU2VydmljZSwgem9uZSkge1xyXG4gICAgICAgIHRoaXMuZWwgPSBlbDtcclxuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICAgICAgdGhpcy5uZzJEcmFnRHJvcFNlcnZpY2UgPSBuZzJEcmFnRHJvcFNlcnZpY2U7XHJcbiAgICAgICAgdGhpcy56b25lID0gem9uZTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiAgRXZlbnQgZmlyZWQgd2hlbiBEcmFnIGRyYWdnZWQgZWxlbWVudCBlbnRlcnMgYSB2YWxpZCBkcm9wIHRhcmdldC5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLm9uRHJhZ0VudGVyID0gbmV3IGNvcmVfMS5FdmVudEVtaXR0ZXIoKTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBFdmVudCBmaXJlZCB3aGVuIGFuIGVsZW1lbnQgaXMgYmVpbmcgZHJhZ2dlZCBvdmVyIGEgdmFsaWQgZHJvcCB0YXJnZXRcclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLm9uRHJhZ092ZXIgPSBuZXcgY29yZV8xLkV2ZW50RW1pdHRlcigpO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEV2ZW50IGZpcmVkIHdoZW4gYSBkcmFnZ2VkIGVsZW1lbnQgbGVhdmVzIGEgdmFsaWQgZHJvcCB0YXJnZXQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5vbkRyYWdMZWF2ZSA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogRXZlbnQgZmlyZWQgd2hlbiBhbiBlbGVtZW50IGlzIGRyb3BwZWQgb24gYSB2YWxpZCBkcm9wIHRhcmdldC5cclxuICAgICAgICAgKi9cclxuICAgICAgICB0aGlzLm9uRHJvcCA9IG5ldyBjb3JlXzEuRXZlbnRFbWl0dGVyKCk7XHJcbiAgICAgICAgLyoqXHJcbiAgICAgICAgICogQ1NTIGNsYXNzIHRoYXQgaXMgYXBwbGllZCB3aGVuIGEgY29tcGF0aWJsZSBkcmFnZ2FibGUgaXMgYmVpbmcgZHJhZ2dlZCBvdmVyIHRoaXMgZHJvcHBhYmxlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuZHJhZ092ZXJDbGFzcyA9ICdkcmFnLW92ZXItYm9yZGVyJztcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBDU1MgY2xhc3MgYXBwbGllZCBvbiB0aGlzIGRyb3BwYWJsZSB3aGVuIGEgY29tcGF0aWJsZSBkcmFnZ2FibGUgaXRlbSBpcyBiZWluZyBkcmFnZ2VkLlxyXG4gICAgICAgICAqIFRoaXMgY2FuIGJlIHVzZWQgdG8gdmlzdWFsbHkgc2hvdyBhbGxvd2VkIGRyb3Agem9uZXMuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5kcmFnSGludENsYXNzID0gJ2RyYWctaGludC1ib3JkZXInO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIERlZmluZXMgY29tcGF0aWJsZSBkcmFnIGRyb3AgcGFpcnMuIFZhbHVlcyBtdXN0IG1hdGNoIGJvdGggaW4gZHJhZ2dhYmxlIGFuZCBkcm9wcGFibGUuZHJvcFNjb3BlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuZHJvcFNjb3BlID0gJ2RlZmF1bHQnO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICogQmFja2luZyBmaWVsZCBmb3IgdGhlIGRyb3BFbmFibGVkIHByb3BlcnR5XHJcbiAgICAgICAgICovXHJcbiAgICAgICAgdGhpcy5fZHJvcEVuYWJsZWQgPSB0cnVlO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICogRmllbGQgZm9yIHRyYWNraW5nIGRyYWcgc3RhdGUuIEhlbHBzIHdoZW5cclxuICAgICAgICAgKiBkcmFnIHN0b3AgZXZlbnQgb2NjdXJzIGJlZm9yZSB0aGUgYWxsb3dEcm9wKClcclxuICAgICAgICAgKiBjYW4gYmUgY2FsY3VsYXRlZCAoYXN5bmMpLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2lzRHJhZ0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgIC8qKlxyXG4gICAgICAgICAqIEBwcml2YXRlXHJcbiAgICAgICAgICogRmllbGQgZm9yIHRyYWNraW5nIGlmIHNlcnZpY2UgaXMgc3Vic2NyaWJlZC5cclxuICAgICAgICAgKiBBdm9pZHMgY3JlYXRpbmcgbXVsdGlwbGUgc3Vic2NyaXB0aW9ucyBvZiBzZXJ2aWNlLlxyXG4gICAgICAgICAqL1xyXG4gICAgICAgIHRoaXMuX2lzU2VydmljZUFjdGl2ZSA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KERyb3BwYWJsZS5wcm90b3R5cGUsIFwiZHJvcEVuYWJsZWRcIiwge1xyXG4gICAgICAgIGdldDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5fZHJvcEVuYWJsZWQ7XHJcbiAgICAgICAgfSxcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiBEZWZpbmVzIGlmIGRyb3AgaXMgZW5hYmxlZC4gYHRydWVgIGJ5IGRlZmF1bHQuXHJcbiAgICAgICAgICovXHJcbiAgICAgICAgc2V0OiBmdW5jdGlvbiAodmFsdWUpIHtcclxuICAgICAgICAgICAgdGhpcy5fZHJvcEVuYWJsZWQgPSB2YWx1ZTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuX2Ryb3BFbmFibGVkID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnN1YnNjcmliZVNlcnZpY2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmVTZXJ2aWNlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIGVudW1lcmFibGU6IHRydWUsXHJcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlXHJcbiAgICB9KTtcclxuICAgIDtcclxuICAgIERyb3BwYWJsZS5wcm90b3R5cGUubmdPbkluaXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZHJvcEVuYWJsZWQgPT09IHRydWUpIHtcclxuICAgICAgICAgICAgdGhpcy5zdWJzY3JpYmVTZXJ2aWNlKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIERyb3BwYWJsZS5wcm90b3R5cGUubmdPbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhpcy51bnN1YnNjcmliZVNlcnZpY2UoKTtcclxuICAgICAgICB0aGlzLnVuYmluZERyYWdMaXN0ZW5lcnMoKTtcclxuICAgIH07XHJcbiAgICBEcm9wcGFibGUucHJvdG90eXBlLmRyYWdFbnRlciA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uKCk7XHJcbiAgICAgICAgdGhpcy5vbkRyYWdFbnRlci5lbWl0KGUpO1xyXG4gICAgfTtcclxuICAgIERyb3BwYWJsZS5wcm90b3R5cGUuZHJhZ092ZXIgPSBmdW5jdGlvbiAoZSwgcmVzdWx0KSB7XHJcbiAgICAgICAgaWYgKHJlc3VsdCkge1xyXG4gICAgICAgICAgICBkb21faGVscGVyXzEuRG9tSGVscGVyLmFkZENsYXNzKHRoaXMuZWwsIHRoaXMuZHJhZ092ZXJDbGFzcyk7XHJcbiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgICAgICAgICAgdGhpcy5vbkRyYWdPdmVyLmVtaXQoZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxuICAgIERyb3BwYWJsZS5wcm90b3R5cGUuZHJhZ0xlYXZlID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICBkb21faGVscGVyXzEuRG9tSGVscGVyLnJlbW92ZUNsYXNzKHRoaXMuZWwsIHRoaXMuZHJhZ092ZXJDbGFzcyk7XHJcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHRoaXMub25EcmFnTGVhdmUuZW1pdChlKTtcclxuICAgIH07XHJcbiAgICBEcm9wcGFibGUucHJvdG90eXBlLmRyb3AgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5hbGxvd0Ryb3AoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICBpZiAocmVzdWx0ICYmIF90aGlzLl9pc0RyYWdBY3RpdmUpIHtcclxuICAgICAgICAgICAgICAgIGRvbV9oZWxwZXJfMS5Eb21IZWxwZXIucmVtb3ZlQ2xhc3MoX3RoaXMuZWwsIF90aGlzLmRyYWdPdmVyQ2xhc3MpO1xyXG4gICAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTtcclxuICAgICAgICAgICAgICAgIF90aGlzLm5nMkRyYWdEcm9wU2VydmljZS5vbkRyYWdFbmQubmV4dCgpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMub25Ecm9wLmVtaXQobmV3IGRyb3BfZXZlbnRfbW9kZWxfMS5Ecm9wRXZlbnQoZSwgX3RoaXMubmcyRHJhZ0Ryb3BTZXJ2aWNlLmRyYWdEYXRhKSk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy5uZzJEcmFnRHJvcFNlcnZpY2UuZHJhZ0RhdGEgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMubmcyRHJhZ0Ryb3BTZXJ2aWNlLnNjb3BlID0gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIERyb3BwYWJsZS5wcm90b3R5cGUuYWxsb3dEcm9wID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdmFyIGFsbG93ZWQgPSBmYWxzZTtcclxuICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTpjdXJseSAqL1xyXG4gICAgICAgIC8qIHRzbGludDpkaXNhYmxlOm9uZS1saW5lICovXHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmRyb3BTY29wZSA9PT0gJ3N0cmluZycpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm5nMkRyYWdEcm9wU2VydmljZS5zY29wZSA9PT0gJ3N0cmluZycpXHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkID0gdGhpcy5uZzJEcmFnRHJvcFNlcnZpY2Uuc2NvcGUgPT09IHRoaXMuZHJvcFNjb3BlO1xyXG4gICAgICAgICAgICBlbHNlIGlmICh0aGlzLm5nMkRyYWdEcm9wU2VydmljZS5zY29wZSBpbnN0YW5jZW9mIEFycmF5KVxyXG4gICAgICAgICAgICAgICAgYWxsb3dlZCA9IHRoaXMubmcyRHJhZ0Ryb3BTZXJ2aWNlLnNjb3BlLmluZGV4T2YodGhpcy5kcm9wU2NvcGUpID4gLTE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKHRoaXMuZHJvcFNjb3BlIGluc3RhbmNlb2YgQXJyYXkpIHtcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiB0aGlzLm5nMkRyYWdEcm9wU2VydmljZS5zY29wZSA9PT0gJ3N0cmluZycpXHJcbiAgICAgICAgICAgICAgICBhbGxvd2VkID0gdGhpcy5kcm9wU2NvcGUuaW5kZXhPZih0aGlzLm5nMkRyYWdEcm9wU2VydmljZS5zY29wZSkgPiAtMTtcclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5uZzJEcmFnRHJvcFNlcnZpY2Uuc2NvcGUgaW5zdGFuY2VvZiBBcnJheSlcclxuICAgICAgICAgICAgICAgIGFsbG93ZWQgPSB0aGlzLmRyb3BTY29wZS5maWx0ZXIoZnVuY3Rpb24gKGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMubmcyRHJhZ0Ryb3BTZXJ2aWNlLnNjb3BlLmluZGV4T2YoaXRlbSkgIT09IC0xO1xyXG4gICAgICAgICAgICAgICAgfSkubGVuZ3RoID4gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIHRoaXMuZHJvcFNjb3BlID09PSAnZnVuY3Rpb24nKSB7XHJcbiAgICAgICAgICAgIGFsbG93ZWQgPSB0aGlzLmRyb3BTY29wZSh0aGlzLm5nMkRyYWdEcm9wU2VydmljZS5kcmFnRGF0YSk7XHJcbiAgICAgICAgICAgIGlmIChhbGxvd2VkIGluc3RhbmNlb2Ygcnhqc18xLk9ic2VydmFibGUpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBhbGxvd2VkLnBpcGUob3BlcmF0b3JzXzEubWFwKGZ1bmN0aW9uIChyZXN1bHQpIHsgcmV0dXJuIHJlc3VsdCAmJiBfdGhpcy5kcm9wRW5hYmxlZDsgfSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8qIHRzbGludDplbmFibGU6Y3VybHkgKi9cclxuICAgICAgICAvKiB0c2xpbnQ6ZGlzYWJsZTpvbmUtbGluZSAqL1xyXG4gICAgICAgIHJldHVybiByeGpzXzEub2YoYWxsb3dlZCAmJiB0aGlzLmRyb3BFbmFibGVkKTtcclxuICAgIH07XHJcbiAgICBEcm9wcGFibGUucHJvdG90eXBlLnN1YnNjcmliZVNlcnZpY2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcclxuICAgICAgICBpZiAodGhpcy5faXNTZXJ2aWNlQWN0aXZlID09PSB0cnVlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5faXNTZXJ2aWNlQWN0aXZlID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmRyYWdTdGFydFN1YnNjcmlwdGlvbiA9IHRoaXMubmcyRHJhZ0Ryb3BTZXJ2aWNlLm9uRHJhZ1N0YXJ0LnN1YnNjcmliZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9pc0RyYWdBY3RpdmUgPSB0cnVlO1xyXG4gICAgICAgICAgICBfdGhpcy5hbGxvd0Ryb3AoKS5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgaWYgKHJlc3VsdCAmJiBfdGhpcy5faXNEcmFnQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZG9tX2hlbHBlcl8xLkRvbUhlbHBlci5hZGRDbGFzcyhfdGhpcy5lbCwgX3RoaXMuZHJhZ0hpbnRDbGFzcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnVuYmluZERyYWdFbnRlckxpc3RlbmVyID0gX3RoaXMucmVuZGVyZXIubGlzdGVuKF90aGlzLmVsLm5hdGl2ZUVsZW1lbnQsICdkcmFnZW50ZXInLCBmdW5jdGlvbiAoZHJhZ0V2ZW50KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kcmFnRW50ZXIoZHJhZ0V2ZW50KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLnVuYmluZERyYWdPdmVyTGlzdGVuZXIgPSBfdGhpcy5yZW5kZXJlci5saXN0ZW4oX3RoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2RyYWdvdmVyJywgZnVuY3Rpb24gKGRyYWdFdmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZHJhZ092ZXIoZHJhZ0V2ZW50LCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMudW5iaW5kRHJhZ0xlYXZlTGlzdGVuZXIgPSBfdGhpcy5yZW5kZXJlci5saXN0ZW4oX3RoaXMuZWwubmF0aXZlRWxlbWVudCwgJ2RyYWdsZWF2ZScsIGZ1bmN0aW9uIChkcmFnRXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIF90aGlzLmRyYWdMZWF2ZShkcmFnRXZlbnQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5kcmFnRW5kU3Vic2NyaXB0aW9uID0gdGhpcy5uZzJEcmFnRHJvcFNlcnZpY2Uub25EcmFnRW5kLnN1YnNjcmliZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIF90aGlzLl9pc0RyYWdBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICAgICAgZG9tX2hlbHBlcl8xLkRvbUhlbHBlci5yZW1vdmVDbGFzcyhfdGhpcy5lbCwgX3RoaXMuZHJhZ0hpbnRDbGFzcyk7XHJcbiAgICAgICAgICAgIF90aGlzLnVuYmluZERyYWdMaXN0ZW5lcnMoKTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICBEcm9wcGFibGUucHJvdG90eXBlLnVuc3Vic2NyaWJlU2VydmljZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGlzLl9pc1NlcnZpY2VBY3RpdmUgPSBmYWxzZTtcclxuICAgICAgICBpZiAodGhpcy5kcmFnU3RhcnRTdWJzY3JpcHRpb24pIHtcclxuICAgICAgICAgICAgdGhpcy5kcmFnU3RhcnRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuZHJhZ0VuZFN1YnNjcmlwdGlvbikge1xyXG4gICAgICAgICAgICB0aGlzLmRyYWdFbmRTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG4gICAgRHJvcHBhYmxlLnByb3RvdHlwZS51bmJpbmREcmFnTGlzdGVuZXJzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmICh0aGlzLnVuYmluZERyYWdFbnRlckxpc3RlbmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMudW5iaW5kRHJhZ0VudGVyTGlzdGVuZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudW5iaW5kRHJhZ092ZXJMaXN0ZW5lcikge1xyXG4gICAgICAgICAgICB0aGlzLnVuYmluZERyYWdPdmVyTGlzdGVuZXIoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudW5iaW5kRHJhZ0xlYXZlTGlzdGVuZXIpIHtcclxuICAgICAgICAgICAgdGhpcy51bmJpbmREcmFnTGVhdmVMaXN0ZW5lcigpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbiAgICBEcm9wcGFibGUuZGVjb3JhdG9ycyA9IFtcclxuICAgICAgICB7IHR5cGU6IGNvcmVfMS5EaXJlY3RpdmUsIGFyZ3M6IFt7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdbZHJvcHBhYmxlXSdcclxuICAgICAgICAgICAgICAgIH0sXSB9LFxyXG4gICAgXTtcclxuICAgIC8qKiBAbm9jb2xsYXBzZSAqL1xyXG4gICAgRHJvcHBhYmxlLmN0b3JQYXJhbWV0ZXJzID0gZnVuY3Rpb24gKCkgeyByZXR1cm4gW1xyXG4gICAgICAgIHsgdHlwZTogY29yZV8xLkVsZW1lbnRSZWYgfSxcclxuICAgICAgICB7IHR5cGU6IGNvcmVfMS5SZW5kZXJlcjIgfSxcclxuICAgICAgICB7IHR5cGU6IG5nX2RyYWdfZHJvcF9zZXJ2aWNlXzEuTmdEcmFnRHJvcFNlcnZpY2UgfSxcclxuICAgICAgICB7IHR5cGU6IGNvcmVfMS5OZ1pvbmUgfVxyXG4gICAgXTsgfTtcclxuICAgIERyb3BwYWJsZS5wcm9wRGVjb3JhdG9ycyA9IHtcclxuICAgICAgICBvbkRyYWdFbnRlcjogW3sgdHlwZTogY29yZV8xLk91dHB1dCB9XSxcclxuICAgICAgICBvbkRyYWdPdmVyOiBbeyB0eXBlOiBjb3JlXzEuT3V0cHV0IH1dLFxyXG4gICAgICAgIG9uRHJhZ0xlYXZlOiBbeyB0eXBlOiBjb3JlXzEuT3V0cHV0IH1dLFxyXG4gICAgICAgIG9uRHJvcDogW3sgdHlwZTogY29yZV8xLk91dHB1dCB9XSxcclxuICAgICAgICBkcmFnT3ZlckNsYXNzOiBbeyB0eXBlOiBjb3JlXzEuSW5wdXQgfV0sXHJcbiAgICAgICAgZHJhZ0hpbnRDbGFzczogW3sgdHlwZTogY29yZV8xLklucHV0IH1dLFxyXG4gICAgICAgIGRyb3BTY29wZTogW3sgdHlwZTogY29yZV8xLklucHV0IH1dLFxyXG4gICAgICAgIGRyb3BFbmFibGVkOiBbeyB0eXBlOiBjb3JlXzEuSW5wdXQgfV0sXHJcbiAgICAgICAgZHJvcDogW3sgdHlwZTogY29yZV8xLkhvc3RMaXN0ZW5lciwgYXJnczogWydkcm9wJywgWyckZXZlbnQnXSxdIH1dXHJcbiAgICB9O1xyXG4gICAgcmV0dXJuIERyb3BwYWJsZTtcclxufSgpKTtcclxuZXhwb3J0cy5Ecm9wcGFibGUgPSBEcm9wcGFibGU7XHJcbiJdfQ==","map":null,"metadata":{},"sourceType":"script"}